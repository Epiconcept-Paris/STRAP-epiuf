---
title: "expandVar"
author: "JHD"
date: "03/06/2022"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{expandVar}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}---
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(epiuf)


```

## Expand function

To expand a variable containing more than one value into new individual variables with Y/N values
The list of expected values must be passed as parameters together with the name of the new variable to be created 
The format of the list is  
    list("value1"="variable_name1",    
       "value2"="variable_name2"    
       )    


Example :
```{r data}
df <- data.frame(numeric_var = c("1|2|3", "2", "3|1", "0|3")
                 ,character_var = c("pfizer,moderna"," ", "pfizer", "moderna"))

InfoSource <- "list(\"0\" = \"vacccard\",\"1\" = \"registry\",\"2\" = \"hospnotes\",\"3\" = \"gpnotes\")"

brand <- "list(\"pfizer\"=\"pfizer\",\"moderna\"=\"moderna\")"

action <- data.frame(variable = colnames(df)
                   ,action_group = rep("expand", ncol(df))
                   ,parameters =  c(InfoSource, brand)
)

```

# Test numeric variable
```{r test1}
df1<- expandVar(data = df, varname = numeric_var, valueslist= eval(parse(text = InfoSource))) 
```
Expected outcome: 4 new variables added to df
numeric_var_vacccard  numeric_var_registry  numeric_var_hospnotes  numeric_var_gpnotes
        0                     1                        1                   1  
        0                     0                        1                   0
        0                     1                        0                   1
        1                     0                        0                   1
        
# Test Character variable
```{r test2}
df1<- expandVar(data = df, varname = character_var, valueslist= eval(parse(text = brand))) 
```

Expected outcome: 2 new variables added to df
character_var_pfizer  character_var_moderna
          1                     1  
          0                     0
          1                     0
          0                     1

# Test using action groups
```{r test3}
df1<- expandVarAll(data = df, action = action)
```
Expected outcome: 6 new variables added to df (identical to above)

